<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let texto;
let readyPlayer2;
let letsPlay = false;
var player2 = {};
var player1;
/**
 * Clase main que hereda de Phaser Scene, para poder manejar los eventos como una escena de Phaser. Se le asigna 
 * como llave el nombre inicio.
 */
var inicio = new Phaser.Class({
  Extends: Phaser.Scene,
  initialize: function () {
    Phaser.Scene.call(this, { key: "inicio" });
  },
  init: function () {},
  /**
   * Se colocan textos en la pantalla.
   */
  preload: function () {
    texto = this.add.text(16, 16, "Inicio", {
      font: "48px Consolas",
      fill: "#FFF",
    });

    readyPlayer2 = this.add.text(16, 64, "Waiting...", {
      font: "48px Consolas",
      fill: "#FFF",
    });
  },
  /**
   * Se revisan que eventos está recibiendo el socket.
   */
  create: function () {
    var self = this;
    this.socket = io();
    console.log(" AAAAAAAI AM THIS SOCKET: ", this.socket);
    this.socket.on("currentPlayers", function (players) {
      console.log("CURRENT PLAYERS EVENT: ", players);

      Object.keys(players).forEach(function (id) {
        console.log("Player id: ", players[id].playerId);

        if (players[id].playerId == self.socket.id) {
          addPlayer(self, players[id]);
        } else {
          addOtherPlayers(self, players[id]);
        }
      });
    });
    this.socket.on("newPlayer", function (playerInfo) {
      console.log("newPlayer event listened on client side");
      addOtherPlayers(self, playerInfo);
    });
    this.socket.on("disconnected", function (playerId) {
      if (player1.playerId == playerId) {
        console.log("player1 disconnected");
      } else {
        console.log("player2 disconnected");
      }
    });
  },
  /**
   * Espera hasta que exista un segundo jugador, para así iniciar el juego y llevarlo a la siguiente escena.
   */
  update: function () {
    texto.setText("Esperando jugador...");
    if (letsPlay) {
      readyPlayer2.setText("Player2 READY, game is loading...");
      this.time.addEvent({
        delay: 3000,
        loop: false,
        callback: () => {
          // Cuando se llama a la otra escena, se le pasa una referencia del socket a ESTA instancia del juego
          this.scene.start("juego", { socket: this.socket, enemy: player2 });
        },
      });
      // this.scene.start("juego");
    }
  },
});
/**
 * Configura al jugador 1.
 * @param {Object} self 
 * @param {string} playerInfo 
 */
function addPlayer(self, playerInfo) {
  self.playerId = playerInfo.playerId;
  self.score = playerInfo.score;
  player1 = self;
  console.log("ADD PLAYER CALLED: ", player1.playerId);
}
/**
 * Configura al jugador 2.
 * @param {Object} self 
 * @param {string} playerInfo 
 */
function addOtherPlayers(self, playerInfo) {
  this.player2.playerId = playerInfo.playerId;
  this.player2.score = playerInfo.score;
  console.log("ADD OTHER PLAYERS CALLED: ", player2.playerId);
  letsPlay = true;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addOtherPlayers">addOtherPlayers</a></li><li><a href="global.html#addPlayer">addPlayer</a></li><li><a href="global.html#create">create</a></li><li><a href="global.html#generateSecuence">generateSecuence</a></li><li><a href="global.html#getElementInSecuence">getElementInSecuence</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#inicio">inicio</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#juego">juego</a></li><li><a href="global.html#preload">preload</a></li><li><a href="global.html#update">update</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Thu Nov 26 2020 12:03:52 GMT-0500 (hora estándar de Colombia)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
